<script lang="ts" setup>
/** 3D行政边界（省、市、县） **/
import { storeToRefs } from 'pinia'
import { nextTick, onMounted } from 'vue'
import { registerComponentRef } from '@/commons/utils/refs/index'
import { usePageStore } from '@/commons/stores/pageStore'

const useInitScene = () => {
    const pageStore = usePageStore()
    const { currentPage } = storeToRefs(pageStore)

    onMounted(() => {
        nextTick(() => {
            /** 全局事件 页面加载完成时 */
            window.SHJParseEvent(currentPage.value.globalEvent, 'on-page-loaded', null)
        })
    })

    return { currentPage }
}

const { currentPage } = useInitScene()

/** 配置参数 */
const sceneOption = {"backButtonLeft":50,"backButtonBottom":5,"debugger":false,"orbitControls":{"panSpeed":1,"minPolarAngle":0,"maxPolarAngle":75,"enablePan":true,"minDistance":50,"maxDistance":300,"enableDamping":true,"enableZoom":true,"zoomSpeed":1},"widgets":[{"rotation":[90,0,0],"width":50,"name":"标注","format":"{name}","_sourceId":"4gech","id":"5akc8","label":{"fontFamily":"SHJ-youshebiaotiHEI-Regular-ttf","color":"#FFFFFF","top":-13,"left":0,"bg":{"paddingH":6,"paddingW":2,"borderColor":"#0D91D49E","color":"#FF000000","borderRadius":6,"borderWidth":0,"borderStyle":"solid"},"show":true,"fontSize":14},"follow":false,"type":"scatter","map":"https://lganv-1304359499.cos.ap-beijing.myqcloud.com/lg_cos_static/users/1899986829344653313/pages/dOS6nqbttET80JGgqNSN/icons8-地图针-94-20250313093625641.png","isHide":false,"height":42},{"texture":"https://lganv-1304359499.cos.ap-beijing.myqcloud.com/lg_cos_static/system/scene/map3d/flyline2.png","radialSegments":8,"format":"{fromName} - {toName}","_sourceId":"7eihd","label":{"fontFamily":"SHJ-SourceHanSansSC-Regular-otf","color":"#2A82E4","bg":{"paddingH":6,"paddingW":2,"borderColor":"#0D91D49E","color":"#05264200","borderRadius":6,"borderWidth":0,"borderStyle":"solid"},"bottom":-4,"show":false,"fontSize":14},"type":"flyline","speed":6,"isHide":false,"segments":64,"middleHeight":10,"material":{"color":"#2A82E4","opacity":1},"name":"飞线","id":"e9b4g","radius":0.5},{"texture":"https://lganv-1304359499.cos.ap-beijing.myqcloud.com/lg_cos_static/system/scene/map3d/flyline.png","radialSegments":8,"format":"{fromName} - {toName}","_sourceId":"khcff","label":{"fontFamily":"SHJ-SourceHanSansSC-Regular-otf","color":"#FFFFFF","bg":{"paddingH":6,"paddingW":2,"borderColor":"#0D91D49E","color":"#05264200","borderRadius":6,"borderWidth":0,"borderStyle":"solid"},"bottom":-4,"show":false,"fontSize":14},"type":"flyline","speed":3,"isHide":false,"segments":64,"middleHeight":10,"material":{"color":"#ffffff","opacity":1},"name":"飞线2","id":"ck3gg","radius":0.1},{"defaultColor":"#212121","name":"地域等级分布","labelStyle":{"fontFamily":"SHJ-SourceHanSansSC-Regular-otf","top":80,"color":"#FFFFFF","left":5,"gap":16,"colorStyle":{"borderRadius":0,"width":14,"height":6},"fontSize":12,"fontStyle":"normal","direction":"column"},"_sourceId":"f57eb","rules":[{"min":0,"color":"#7FF08C","max":100,"label":"轻微"},{"min":101,"color":"#5FD96E","max":201,"label":"一般"},{"min":202,"color":"#3EB049","max":302,"label":"中等"},{"min":303,"color":"#289E35","max":403,"label":"较大"},{"min":404,"color":"#0C941C","max":504,"label":"严重"}],"id":"7de61","type":"regionalLevel","opacity":0.5,"isHide":false}],"scene":{"geojson":"","translateZ":0,"isDrilling":true,"defaultMapAdcode":520000,"background":"#0D0D0D","translateY":0,"translateX":0,"defaultMap":"china","isBackground":true},"light":{"pointLight2":{"intensity":60,"color":"#ffffff","distance":30,"show":true,"x":-4,"y":8,"z":43},"ambientLight":{"intensity":1,"color":"#FFFFFF","show":true},"directionalLight":{"intensity":2,"color":"#ffffff","show":true,"position":{"x":-22,"y":128,"z":-20},"target":{"position":{"x":0,"y":0,"z":0}}},"pointLight1":{"intensity":60,"color":"#ffffff","distance":24,"show":true,"x":1,"y":19,"z":7}},"backButtonCss":{"backgroundColor":"#1F5EFF","borderColor":"#0088FFC3","fontFamily":"SHJ-SourceHanSansSC-Regular-otf","color":"#FFFFFF","borderRadius":4,"backgroundImage":"","borderWidth":1,"backgroundSize":"cover","fontSize":12,"fontStyle":"normal","borderStyle":"solid","fontWeight":600},"backButton":true,"particle":{"material":{"size":10,"color":"#2EB059","opacity":0.3},"num":10,"show":true,"range":200,"dir":"up","speed":0.1},"floor":{"quan":{"color":"#007BFF","show":true},"gaoguang":{"color":"#545454","show":true},"gridRipple":{"diffuseWidth":20,"color":"#8A7B63","diffuseOpacity":0.5,"alphaMap":"/map3d/gridRippleAlphaMap.png","repeat":100,"show":true,"diffuseSpeed":30,"diffuseColor":"#8A7B63","opacity":0.1,"map":"/map3d/gridRippleMap.png"},"rotateBorder":{"rotateBorder1":{"size":1.18,"color":"#44574B","texture":"/map3d/rotateBorder1Map.png","show":true,"rotateSpeed":1,"opacity":0.2},"rotateBorder2":{"size":1.12,"color":"#44574B","texture":"/map3d/rotateBorder2Map.png","show":true,"rotateSpeed":-4,"opacity":0.4}}},"camera":{"position":{"x":0,"y":145,"z":69},"target":[0,0,0]},"widgetControlStyle":{"backgroundColor":"#00000000","borderColor":"#5B687559","color":"#D9D9D9","backgroundImage":"","show":true,"active":{"backgroundColor":"#D9D9D926","borderColor":"#5D9691","color":"#FFFFFF","backgroundImage":"","borderWidth":0,"fontSize":12,"fontStyle":"italic","borderStyle":"dashed","fontWeight":600},"fontStyle":"italic","hover":{"backgroundColor":"#DBDBDB0A","borderColor":"#498B91","color":"#FFFFFF","backgroundImage":"","borderWidth":0,"fontSize":12,"fontStyle":"italic","borderStyle":"solid","fontWeight":600},"fontFamily":"SHJ-DreamHanSansCN-W1-ttf","top":50,"borderRadius":4,"left":95,"borderWidth":0,"gap":8,"width":94,"backgroundSize":"cover","fontSize":12,"borderStyle":"solid","fontWeight":600,"direction":"column","height":34},"map":{"hoverLineColor":"#CCCCCC","depth":5,"titleLabel":{"offsetX":0,"fontFamily":"SHJ-SourceHanSansSC-Bold-otf","offsetY":3,"color":"#FFFFFF","bottom":2,"show":true,"fontSize":46,"gaodeAPI":"f7d75cd912376e5ade47187998ebbd31"},"backgroundImg":{"color":"#FFFFFF","src":"https://lganv-1304359499.cos.ap-beijing.myqcloud.com/lg_cos_static/system/scene/map3d/004_bg.jpg","alphaMap":"https://lganv-1304359499.cos.ap-beijing.myqcloud.com/lg_cos_static/system/scene/map3d/004_bg.jpg","rotation":[90,-180,180],"show":false,"scale":[0.42,0.42,0.42],"position":[-8.7,0.1,11.7],"opacity":1},"mirrorShow":true,"sideMaterial":{"color":"#7F8F4C","opacity":1,"map":""},"arealabel":{"fontFamily":"SHJ-SourceHanSansSC-Regular-otf","color":"#FFFFFF","bottom":2,"show":true,"fontSize":12},"lineColor":"#CCCCCC","topMaterial":{"emissive":"#000000","color":"#FFFFFF","hoverOpacity":1,"normalMap":"/map3d/topNormal.jpg","opacity":1,"map":"/map3d/微信图片_20240511161437-20240628173433407.jpg"},"storkeAnimation":{"color":"#FFFFFF","top":1,"texture":"/map3d/pathLine.png","radius":0.2,"speed":0.3,"segments":1000},"hoverDepth":1.5}}
/** 数据源 */
const sceneSources = [{"name":"标注数据","id":"4gech","source":{"mapping":[{"mapping":"name","name":"name","label":"名称","type":"string","status":false},{"mapping":"adcode","name":"adcode","label":"行政区划代码","type":"string","status":false},{"mapping":"lng","name":"lng","label":"经度","type":"number","status":false},{"mapping":"lat","name":"lat","label":"纬度","type":"number","status":false},{"mapping":"value","name":"value","label":"值","type":"number","status":false}],"static":[{"lng":105.6736,"adcode":520400,"name":"黄果树瀑布","tag":["5A景区","世界著名瀑布"],"value":95,"lat":25.9852},{"lng":107.8793,"adcode":522700,"name":"荔波小七孔","tag":["世界自然遗产","喀斯特精华"],"value":93,"lat":25.2945},{"lng":108.6906,"adcode":520600,"name":"梵净山","tag":["世界自然遗产","佛教名山"],"value":90,"lat":27.9282},{"lng":105.7684,"adcode":520500,"name":"织金洞","tag":["中国溶洞之王","岩溶博物馆"],"value":88,"lat":26.6688},{"lng":106.3758,"adcode":522600,"name":"云台山","tag":["世界自然遗产","白云岩喀斯特"],"value":85,"lat":28.1653},{"lng":104.8546,"adcode":520200,"name":"乌蒙大草原","tag":["高山草原","风电景观"],"value":83,"lat":25.0935},{"lng":106.2002,"adcode":520300,"name":"赤水竹海","tag":["竹海国家森林公园"],"value":80,"lat":28.7598},{"lng":106.7002,"adcode":520100,"name":"青岩古镇","tag":["明清军事重镇","贵州四大古镇"],"value":92,"lat":26.3455},{"lng":107.0233,"adcode":520300,"name":"遵义会议会址","tag":["红色旅游经典"],"value":89,"lat":27.6945},{"lng":108.4297,"adcode":522600,"name":"镇远古城","tag":["历史文化名城","太极古镇"],"value":87,"lat":27.0491},{"lng":105.4755,"adcode":520400,"name":"天龙屯堡","tag":["明代军屯活化石"],"value":84,"lat":26.8743},{"lng":106.8167,"adcode":522700,"name":"猴场会议会址","tag":["转折前夜会议"],"value":82,"lat":26.5833},{"lng":108.1829,"adcode":522600,"name":"西江千户苗寨","tag":["最大苗族聚居区"],"value":94,"lat":26.5132},{"lng":109.1929,"adcode":522600,"name":"肇兴侗寨","tag":["侗族大歌发源地"],"value":88,"lat":25.9094},{"lng":108.3157,"adcode":522600,"name":"岜沙苗寨","tag":["最后一个枪手部落"],"value":85,"lat":25.7537},{"lng":107.1733,"adcode":522600,"name":"高华瑶寨","tag":["瑶族药浴之乡"],"value":83,"lat":26.5744},{"lng":106.0015,"adcode":522700,"name":"好花红村","tag":["布依族民歌之乡"],"value":80,"lat":25.4258},{"lng":107.1289,"adcode":522700,"name":"中国天眼","tag":["FAST望远镜"],"value":91,"lat":26.8604},{"lng":106.3722,"adcode":520300,"name":"茅台镇","tag":["中国酒都"],"value":87,"lat":27.8206},{"lng":105.6347,"adcode":522700,"name":"平塘天坑群","tag":["世界最大天坑群"],"value":84,"lat":26.8452},{"lng":105.6177,"adcode":520200,"name":"北盘江大桥","tag":["世界最高大桥"],"value":82,"lat":24.9707},{"lng":106.6584,"adcode":520100,"name":"花溪夜郎谷","tag":["现代石头艺术"],"value":79,"lat":26.4305},{"lng":105.7733,"adcode":522300,"name":"二十四道拐","tag":["史迪威公路奇观"],"value":76,"lat":25.4329},{"lng":108.7813,"adcode":520600,"name":"朱砂古镇","tag":["千年汞矿遗址"],"value":75,"lat":28.1413}],"isAutoUpdate":false,"autoUpdateTime":60,"type":"static"}},{"name":"飞线","id":"7eihd","source":{"mapping":[{"mapping":"toName","name":"toName","label":"起始","type":"string","status":false},{"mapping":"fromName","name":"fromName","label":"结束","type":"string","status":false},{"mapping":"coords","name":"coords","label":"值","type":"array","status":false}],"static":[{"toName":"黄果树瀑布","fromName":"重庆","coords":[[106.551538,29.585581],[105.6736,25.9852]]},{"toName":"西江千户苗寨","fromName":"广州","coords":[[113.269288,23.132324],[108.1829,26.5132]]},{"toName":"荔波小七孔","fromName":"南宁","coords":[[108.320004,22.82402],[107.8793,25.2945]]},{"toName":"梵净山","fromName":"贵阳","coords":[[106.630153,26.647661],[108.6906,27.9282]]},{"toName":"镇远古镇","fromName":"遵义","coords":[[107.031532,27.699961],[108.4297,27.0491]]},{"toName":"中国天眼","fromName":"都匀","coords":[[107.524445,26.259456],[107.1289,26.8604]]},{"toName":"北盘江大桥","fromName":"昆明","coords":[[102.847212,24.879871],[105.6177,24.9707]]},{"toName":"赤水丹霞","fromName":"成都","coords":[[104.074613,30.666053],[105.9998,28.5442]]},{"toName":"茅台镇","fromName":"北京","coords":[[116.413554,39.911013],[106.3722,27.8206]]}],"isAutoUpdate":false,"autoUpdateTime":60,"type":"static"}},{"name":"飞线2","id":"khcff","source":{"mapping":[{"mapping":"toName","name":"toName","label":"起始","type":"string","status":false},{"mapping":"fromName","name":"fromName","label":"结束","type":"string","status":false},{"mapping":"coords","name":"coords","label":"值","type":"array","status":false}],"static":[{"toName":"黄果树瀑布","fromName":"重庆","coords":[[106.551538,29.585581],[105.6736,25.9852]]},{"toName":"西江千户苗寨","fromName":"广州","coords":[[113.269288,23.132324],[108.1829,26.5132]]},{"toName":"荔波小七孔","fromName":"南宁","coords":[[108.320004,22.82402],[107.8793,25.2945]]},{"toName":"梵净山","fromName":"贵阳","coords":[[106.630153,26.647661],[108.6906,27.9282]]},{"toName":"镇远古镇","fromName":"遵义","coords":[[107.031532,27.699961],[108.4297,27.0491]]},{"toName":"中国天眼","fromName":"都匀","coords":[[107.524445,26.259456],[107.1289,26.8604]]},{"toName":"北盘江大桥","fromName":"昆明","coords":[[102.847212,24.879871],[105.6177,24.9707]]},{"toName":"赤水丹霞","fromName":"成都","coords":[[104.074613,30.666053],[105.9998,28.5442]]},{"toName":"茅台镇","fromName":"北京","coords":[[116.413554,39.911013],[106.3722,27.8206]]}],"isAutoUpdate":false,"autoUpdateTime":60,"type":"static"}},{"name":"地域等级分布","id":"f57eb","source":{"mapping":[{"mapping":"name","name":"name","label":"地域名称","type":"string","status":true},{"mapping":"value","name":"value","label":"值","type":"number","status":true}],"static":[{"name":"河南省","value":450},{"name":"新疆维吾尔自治区","value":50},{"name":"西藏自治区","value":150},{"name":"青海省","value":150},{"name":"云南省","value":350},{"name":"四川省","value":150},{"name":"甘肃省","value":150},{"name":"宁夏回族自治区","value":150},{"name":"陕西省","value":150},{"name":"重庆市","value":350},{"name":"贵州省","value":350},{"name":"广西壮族自治区","value":250},{"name":"广东省","value":250},{"name":"海南省","value":50},{"name":"香港特别行政区","value":50},{"name":"澳门特别行政区","value":50},{"name":"湖南省","value":450},{"name":"湖北省","value":450},{"name":"山西省","value":150},{"name":"内蒙古自治区","value":150},{"name":"河北省","value":150},{"name":"山东省","value":150},{"name":"安徽省","value":450},{"name":"江西省","value":450},{"name":"福建省","value":250},{"name":"台湾省","value":250},{"name":"浙江省","value":250},{"name":"江苏省","value":250},{"name":"上海市","value":150},{"name":"山东省","value":150},{"name":"北京市","value":150},{"name":"天津市","value":150},{"name":"辽宁省","value":150},{"name":"吉林省","value":150},{"name":"黑龙江省","value":150}],"isAutoUpdate":false,"autoUpdateTime":60,"type":"static"}}]
</script>
<template>
    <div class="shj-scene">
        <!-- 使用@shjjs/visual-ui全局组件，basic-option暴漏所有参数可修改，sources为指定数据源 -->
        <zv-scene-map3d
            :ref="registerComponentRef(`scene-map3d-7`)"
            :basic-option="sceneOption"
            :sources="sceneSources"
            :use-events="currentPage.globalEvent"
        ></zv-scene-map3d>
    </div>
</template>
<style lang="scss" scoped>
.shj-scene {
    width: 100%;
    height: 100%;
    position: absolute;
    z-index: -1;
}
</style>